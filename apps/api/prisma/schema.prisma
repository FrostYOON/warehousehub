generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  ADMIN
  WH_MANAGER
  DELIVERY
  ACCOUNTING
  SALES
}

enum StorageType {
  DRY
  COOL
  FRZ
}

model Company {
  id   String @id @default(uuid())
  name String

  users      User[]
  warehouses Warehouse[]
  items      Item[]
  customers  Customer[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model User {
  id        String  @id @default(uuid())
  companyId String
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  email        String
  passwordHash String
  name         String
  role         Role    @default(WH_MANAGER)
  isActive     Boolean @default(true)

  refreshTokens RefreshToken[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([companyId, email])
  @@index([companyId])
  @@index([role])
}

model Warehouse {
  id        String  @id @default(uuid())
  companyId String
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  type StorageType
  name String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([companyId, type])
  @@index([companyId])
}

model Item {
  id        String  @id @default(uuid())
  companyId String
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  itemCode String
  itemName String
  isActive Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([companyId, itemCode])
  @@index([companyId])
  @@index([itemCode])
}

model Customer {
  id        String  @id @default(uuid())
  companyId String
  company   Company @relation(fields: [companyId], references: [id], onDelete: Cascade)

  customerName    String
  customerAddress String
  lat             Decimal? @db.Decimal(10, 7)
  lng             Decimal? @db.Decimal(10, 7)
  isActive        Boolean  @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([companyId])
  @@index([customerName])
}

model RefreshToken {
  id     String @id @default(uuid())
  userId String
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  tokenHash String
  expiresAt DateTime
  revokedAt DateTime?
  createdAt DateTime  @default(now())

  @@index([userId])
  @@index([expiresAt])
  @@index([tokenHash])
}
